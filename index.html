<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ChairControl - Gestão de Manutenção e Projetos</title>
    
    <!-- 1. Tailwind CSS (Estilos) -->
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- Configuração para evitar FOUC -->
    <style>
        body { opacity: 0; transition: opacity 0.5s; }
        ::-webkit-scrollbar { width: 8px; height: 8px; }
        ::-webkit-scrollbar-track { background: transparent; }
        ::-webkit-scrollbar-thumb { background: #cbd5e1; border-radius: 4px; }
        ::-webkit-scrollbar-thumb:hover { background: #94a3b8; }
        
        .recharts-tooltip-wrapper { z-index: 1000; }
        .custom-scrollbar::-webkit-scrollbar { width: 4px; }
        .custom-scrollbar::-webkit-scrollbar-thumb { background: #e2e8f0; border-radius: 2px; }
        
        @keyframes pulse-ring {
            0% { transform: scale(0.33); }
            80%, 100% { opacity: 0; }
        }
        .pulse-ring::before {
            content: '';
            position: absolute;
            left: -4px; top: -4px; right: -4px; bottom: -4px;
            border-radius: 50%;
            border: 2px solid #ef4444;
            animation: pulse-ring 1.25s cubic-bezier(0.215, 0.61, 0.355, 1) infinite;
        }
    </style>
</head>
<body class="bg-slate-50 text-slate-800 font-sans">
    
    <div id="root"></div>

    <script type="importmap">
    {
        "imports": {
            "react": "https://esm.sh/react@18.2.0",
            "react-dom": "https://esm.sh/react-dom@18.2.0",
            "react-dom/client": "https://esm.sh/react-dom@18.2.0/client",
            "lucide-react": "https://esm.sh/lucide-react@0.294.0",
            "recharts": "https://esm.sh/recharts@2.10.3?external=react,react-dom",
            "firebase/app": "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js",
            "firebase/auth": "https://www.gstatic.com/firebasejs/10.7.1/firebase-auth.js",
            "firebase/firestore": "https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js"
        }
    }
    </script>

    <script type="module">
        import React, { useState, useEffect, useMemo, useRef } from 'react';
        import { createRoot } from 'react-dom/client';
        
        import { 
            LayoutDashboard, PlusCircle, List, TrendingUp, CheckCircle, 
            XCircle, Clock, Search, Trash2, Edit2, Package, X, AlertTriangle,
            Settings, Calendar, Save, Filter, Wallet, DollarSign, PieChart as PieIcon,
            CheckSquare, XSquare, Hourglass, Building2, Eye, BarChart as BarChartIcon,
            Truck, Lock, User, LogIn, Bell, Check, Download, FileSpreadsheet, Eraser, RefreshCw,
            FolderKanban, Briefcase, ChevronRight
        } from 'lucide-react';

        import { 
            PieChart, Pie, Cell, Tooltip, ResponsiveContainer, Legend
        } from 'recharts';

        import { initializeApp } from 'firebase/app';
        import { 
            getFirestore, collection, addDoc, onSnapshot, 
            doc, deleteDoc, updateDoc, setDoc, getDoc, arrayUnion, query, where, writeBatch 
        } from 'firebase/firestore';
        import { 
            getAuth, signInAnonymously, onAuthStateChanged 
        } from 'firebase/auth';

        // --- CONFIGURAÇÃO DO FIREBASE ---
        const firebaseConfig = {
            apiKey: "AIzaSyC2sCd7LLsDIgtsyKWrz2aaHmBojglK7pg",
            authDomain: "controle-de-manutencoes-49274.firebaseapp.com",
            projectId: "controle-de-manutencoes-49274",
            storageBucket: "controle-de-manutencoes-49274.firebasestorage.app",
            messagingSenderId: "32715522228",
            appId: "1:32715522228:web:65637da97de422c2f497e1",
            measurementId: "G-T6TS6Y6NT5"
        };

        const app = initializeApp(firebaseConfig);
        const auth = getAuth(app);
        const db = getFirestore(app);
        const appId = typeof __app_id !== 'undefined' ? __app_id : "producao-oficial";

        // --- CONSTANTES PADRÃO ---
        const DEFAULT_UNIDADES = [
            "Alphaville", "Anchieta", "Araçatuba", "Araraquara", "Assis", "Bacelar", "Bauru", "Brasília", 
            "Campinas", "Cancioneiro", "Cid. Universitária", "Goiânia Flamboyant", "Jundiaí", "Limeira", 
            "Manaus", "Marques S. Vicente", "Norte", "Paraíso", "Paulista", "Paz", "Paz / Henri Dunant", 
            "Pinheiros", "Ribeirão Preto", "Santos", "São José do Rio Pardo", "São José dos Campos", 
            "Sorocaba", "Taquari", "Tatuapé", "Vergueiro", "São José do Rio Preto"
        ];

        const DEFAULT_DEPARTAMENTOS = [
            "Administrativo", "Comercial", "Financeiro", "RH", "TI", "Manutenção", "Limpeza", "Secretaria", "Diretoria"
        ];
        
        const DEFAULT_FORNECEDORES = [];

        const STATUS_OPTIONS = [
            { value: 'Executado', label: 'Executado', color: 'bg-green-100 text-green-700 border-green-200', icon: CheckSquare, hex: '#16a34a' },
            { value: 'Indeferido', label: 'Indeferido', color: 'bg-red-100 text-red-700 border-red-200', icon: XSquare, hex: '#dc2626' },
            { value: 'Aguardando Aprovação', label: 'Aguardando Aprovação', color: 'bg-blue-100 text-blue-700 border-blue-200', icon: Hourglass, hex: '#2563eb' }
        ];

        const DEPT_COLORS = ['#3b82f6', '#8b5cf6', '#ec4899', '#f43f5e', '#f97316', '#eab308', '#84cc16', '#10b981', '#06b6d4', '#6366f1'];
        const MONTHS = ['Janeiro', 'Fevereiro', 'Março', 'Abril', 'Maio', 'Junho', 'Julho', 'Agosto', 'Setembro', 'Outubro', 'Novembro', 'Dezembro'];

        // --- UTILS ---
        const isWithinPeriod = (dateStr, period, selectedDate) => {
            if (!dateStr) return false;
            const date = new Date(dateStr);
            const now = new Date();
            const referenceDate = selectedDate || now;

            if (period === 'day') {
                const startOfDay = new Date(now.getFullYear(), now.getMonth(), now.getDate());
                return date >= startOfDay;
            }
            if (period === 'week') {
                const startOfWeek = new Date(now);
                startOfWeek.setDate(now.getDate() - 7);
                return date >= startOfWeek;
            }
            if (period === 'month') {
                return date.getMonth() === referenceDate.getMonth() && date.getFullYear() === referenceDate.getFullYear();
            }
            if (period === 'year') {
                return date.getFullYear() === referenceDate.getFullYear();
            }
            return true;
        };

        const formatDate = (dateStr) => {
            if (!dateStr) return '-';
            return new Date(dateStr).toLocaleString('pt-BR', { 
                day: '2-digit', month: '2-digit', year: 'numeric', 
                hour: '2-digit', minute: '2-digit' 
            });
        };

        const exportToCSV = (data, filename) => {
            const headers = ["Data", "Unidade", "Departamento", "Fornecedor", "Nº Pedido", "Valor", "Status"];
            const rows = data.map(item => [
                new Date(item.createdAt).toLocaleString('pt-BR'),
                item.unit,
                item.department,
                item.supplier || '',
                `'${item.orderNumber}`,
                Number(item.value).toFixed(2).replace('.', ','),
                item.status
            ]);
            const csvContent = headers.join(';') + '\n' + rows.map(r => r.map(c => `"${c}"`).join(';')).join('\n');
            const blob = new Blob(["\ufeff" + csvContent], { type: 'text/csv;charset=utf-8;' });
            const link = document.createElement("a");
            link.href = URL.createObjectURL(blob);
            link.download = `${filename}.csv`;
            link.click();
        };

        // --- LOGIN SCREEN ---
        function LoginScreen({ onLogin, onRequestAccess, accessStatus }) {
            const [name, setName] = useState('');
            const [password, setPassword] = useState('');
            const [mode, setMode] = useState('login');

            const handleLogin = (e) => {
                e.preventDefault();
                if (name === 'Jordan' && password === 'Areliteamo') onLogin('owner');
                else alert("Credenciais incorretas.");
            };

            const handleRequest = (e) => {
                e.preventDefault();
                if (!name.trim()) return alert("Por favor, informe seu nome.");
                onRequestAccess(name);
            };

            if (accessStatus === 'pending') {
                return React.createElement('div', { className: "min-h-screen bg-slate-900 flex items-center justify-center p-4" },
                    React.createElement('div', { className: "bg-white p-8 rounded-3xl max-w-md w-full text-center space-y-6 animate-in zoom-in-95 duration-300" },
                        React.createElement('div', { className: "w-20 h-20 bg-blue-50 rounded-full flex items-center justify-center mx-auto" },
                            React.createElement('div', { className: "animate-spin rounded-full h-8 w-8 border-b-2 border-blue-600" })
                        ),
                        React.createElement('h2', { className: "text-2xl font-black text-slate-900" }, "Aguardando Autorização"),
                        React.createElement('p', { className: "text-slate-500" }, "O responsável foi notificado do seu acesso. Por favor, aguarde a liberação nesta tela.")
                    )
                );
            }

            return React.createElement('div', { className: "min-h-screen bg-slate-900 flex items-center justify-center p-4" },
                React.createElement('div', { className: "bg-white p-10 rounded-3xl max-w-md w-full shadow-2xl animate-in fade-in duration-500" },
                    React.createElement('div', { className: "text-center mb-10" },
                        React.createElement('div', { className: "w-16 h-16 bg-slate-900 rounded-2xl flex items-center justify-center mx-auto mb-4 text-white" }, React.createElement(LayoutDashboard, { size: 32 })),
                        React.createElement('h1', { className: "text-2xl font-black text-slate-900" }, "ChairControl"),
                        React.createElement('p', { className: "text-slate-400 font-medium text-sm" }, "Área restrita a pessoas autorizadas")
                    ),
                    mode === 'login' ? (
                        React.createElement('form', { onSubmit: handleLogin, className: "space-y-4" },
                            React.createElement('div', { className: "space-y-1" },
                                React.createElement('label', { className: "text-xs font-bold uppercase text-slate-500 ml-1" }, "Usuário"),
                                React.createElement('input', { className: "w-full p-4 bg-slate-50 border border-slate-200 rounded-xl outline-none focus:ring-2 focus:ring-slate-900 transition-all font-medium", value: name, onChange: e => setName(e.target.value), placeholder: "Nome de usuário" })
                            ),
                            React.createElement('div', { className: "space-y-1" },
                                React.createElement('label', { className: "text-xs font-bold uppercase text-slate-500 ml-1" }, "Senha"),
                                React.createElement('input', { type: "password", className: "w-full p-4 bg-slate-50 border border-slate-200 rounded-xl outline-none focus:ring-2 focus:ring-slate-900 transition-all font-medium", value: password, onChange: e => setPassword(e.target.value), placeholder: "••••••••" })
                            ),
                            React.createElement('button', { className: "w-full py-4 bg-slate-900 text-white font-bold rounded-xl hover:bg-slate-800 transition-all mt-2" }, "Entrar"),
                            React.createElement('button', { type: "button", onClick: () => setMode('request'), className: "w-full py-4 text-slate-500 font-bold text-sm hover:text-slate-900 transition-colors" }, "Não sou o dono, solicitar acesso")
                        )
                    ) : (
                        React.createElement('form', { onSubmit: handleRequest, className: "space-y-4" },
                            React.createElement('div', { className: "space-y-1" },
                                React.createElement('label', { className: "text-xs font-bold uppercase text-slate-500 ml-1" }, "Seu Nome"),
                                React.createElement('input', { className: "w-full p-4 bg-slate-50 border border-slate-200 rounded-xl outline-none focus:ring-2 focus:ring-blue-600 transition-all font-medium", value: name, onChange: e => setName(e.target.value), placeholder: "Como devemos te chamar?" })
                            ),
                            React.createElement('button', { className: "w-full py-4 bg-blue-600 text-white font-bold rounded-xl hover:bg-blue-700 transition-all mt-2" }, "Solicitar Acesso"),
                            React.createElement('button', { type: "button", onClick: () => setMode('login'), className: "w-full py-4 text-slate-500 font-bold text-sm hover:text-slate-900 transition-colors" }, "Voltar para Login")
                        )
                    )
                )
            );
        }

        // --- APP ---
        function App() {
            const [user, setUser] = useState(null);
            const [isAuthenticated, setIsAuthenticated] = useState(false);
            const [currentUserRole, setCurrentUserRole] = useState(null);
            const [accessRequestId, setAccessRequestId] = useState(null);
            const [accessRequestStatus, setAccessRequestStatus] = useState('idle');
            const [pendingRequests, setPendingRequests] = useState([]);
            const [showRequestsModal, setShowRequestsModal] = useState(false);
            const [showClearAllModal, setShowClearAllModal] = useState(false);

            const [activeTab, setActiveTab] = useState('projects');
            const [maintenances, setMaintenances] = useState([]);
            const [projects, setProjects] = useState([]);
            const [activeProjectId, setActiveProjectId] = useState('all');
            
            const [loading, setLoading] = useState(true);
            const [editingItem, setEditingItem] = useState(null);
            const [deleteId, setDeleteId] = useState(null);
            const [viewingUnit, setViewingUnit] = useState(null);
            const [filters, setFilters] = useState({ search: '', unit: '', status: '' });
            
            const [dashboardPeriod, setDashboardPeriod] = useState('all');
            const [listPeriod, setListPeriod] = useState('all');
            const [selectedFilterDate, setSelectedFilterDate] = useState(new Date());

            const [exportPeriod, setExportPeriod] = useState('all');
            const [exportDate, setExportDate] = useState(new Date());

            const [settings, setSettings] = useState({
                appName: 'ChairControl',
                primaryColor: '#2563eb',
                units: DEFAULT_UNIDADES,
                departments: DEFAULT_DEPARTAMENTOS,
                suppliers: DEFAULT_FORNECEDORES
            });

            useEffect(() => {
                document.body.style.opacity = '1';
                signInAnonymously(auth).catch(err => console.error("Auth Error:", err));
                const unsubscribe = onAuthStateChanged(auth, setUser);
                return () => unsubscribe();
            }, []);

            useEffect(() => {
                if (!user) return;
                
                const qMaintenances = collection(db, 'artifacts', appId, 'public', 'data', 'maintenances');
                const unsubscribeMaintenances = onSnapshot(qMaintenances, (snapshot) => {
                    const data = snapshot.docs.map(doc => ({ id: doc.id, ...doc.data() }));
                    data.sort((a, b) => new Date(b.createdAt) - new Date(a.createdAt));
                    setMaintenances(data);
                    setLoading(false);
                });

                const qProjects = collection(db, 'artifacts', appId, 'public', 'data', 'projects');
                const unsubscribeProjects = onSnapshot(qProjects, (snapshot) => {
                    const data = snapshot.docs.map(doc => ({ id: doc.id, ...doc.data() }));
                    data.sort((a, b) => a.name.localeCompare(b.name));
                    setProjects(data);
                });

                const docSettings = doc(db, 'artifacts', appId, 'public', 'data', 'settings', 'global');
                const unsubscribeSettings = onSnapshot(docSettings, (docSnap) => {
                    if (docSnap.exists()) {
                        const data = docSnap.data();
                        const sortAlpha = (arr) => [...(arr || [])].sort((a, b) => a.localeCompare(b));
                        setSettings(prev => ({ 
                            ...prev, ...data,
                            departments: sortAlpha(data.departments || DEFAULT_DEPARTAMENTOS),
                            suppliers: sortAlpha(data.suppliers || DEFAULT_FORNECEDORES)
                        }));
                    }
                });

                return () => { 
                    unsubscribeMaintenances(); 
                    unsubscribeProjects();
                    unsubscribeSettings(); 
                };
            }, [user]);

            useEffect(() => {
                if (!user || currentUserRole !== 'owner') return;
                const qRequests = query(collection(db, 'artifacts', appId, 'public', 'data', 'access_requests'), where("status", "==", "pending"));
                const unsubscribeRequests = onSnapshot(qRequests, (snapshot) => {
                    const reqs = snapshot.docs.map(doc => ({ id: doc.id, ...doc.data() }));
                    setPendingRequests(reqs);
                });
                return () => unsubscribeRequests();
            }, [user, currentUserRole]);

            useEffect(() => {
                if (!user || !accessRequestId) return;
                const docRef = doc(db, 'artifacts', appId, 'public', 'data', 'access_requests', accessRequestId);
                const unsubscribe = onSnapshot(docRef, (docSnap) => {
                    if (docSnap.exists()) {
                        const status = docSnap.data().status;
                        setAccessRequestStatus(status);
                        if (status === 'approved') { setIsAuthenticated(true); setCurrentUserRole('guest'); }
                        else if (status === 'rejected') { setAccessRequestId(null); setAccessRequestStatus('idle'); alert("Acesso negado."); }
                    }
                });
                return () => unsubscribe();
            }, [user, accessRequestId]);

            // Estatísticas
            const stats = useMemo(() => {
                let data = maintenances.filter(m => isWithinPeriod(m.createdAt, dashboardPeriod, selectedFilterDate));
                if (activeProjectId !== 'all') {
                    data = data.filter(m => m.projectId === activeProjectId);
                }

                const totalValue = data.reduce((acc, curr) => acc + Number(curr.value || 0), 0);
                const valueExecutado = data.filter(m => m.status === 'Executado').reduce((acc, curr) => acc + Number(curr.value || 0), 0);
                const valuePendente = data.filter(m => m.status === 'Aguardando Aprovação').reduce((acc, curr) => acc + Number(curr.value || 0), 0);
                const valueIndeferido = data.filter(m => m.status === 'Indeferido').reduce((acc, curr) => acc + Number(curr.value || 0), 0);

                const countExecutado = data.filter(m => m.status === 'Executado').length;
                const countPendente = data.filter(m => m.status === 'Aguardando Aprovação').length;
                const countIndeferido = data.filter(m => m.status === 'Indeferido').length;

                const unitsMap = {};
                data.forEach(item => {
                    const u = item.unit || 'Sem Unidade';
                    if (!unitsMap[u]) unitsMap[u] = { name: u, count: 0, totalValue: 0 };
                    unitsMap[u].count += 1;
                    unitsMap[u].totalValue += Number(item.value || 0);
                });
                const unitStats = Object.values(unitsMap).sort((a, b) => b.count - a.count);

                return { count: data.length, countExecutado, countPendente, countIndeferido, totalValue, valueExecutado, valuePendente, valueIndeferido, unitStats };
            }, [maintenances, dashboardPeriod, selectedFilterDate, activeProjectId]);

            const filteredListData = useMemo(() => {
                return maintenances.filter(m => {
                    const matchProject = activeProjectId === 'all' || m.projectId === activeProjectId;
                    const matchSearch = !filters.search || 
                        (m.department && m.department.toLowerCase().includes(filters.search.toLowerCase())) ||
                        (m.supplier && m.supplier.toLowerCase().includes(filters.search.toLowerCase())) ||
                        (m.orderNumber && m.orderNumber.includes(filters.search));
                    const matchUnit = !filters.unit || m.unit === filters.unit;
                    const matchStatus = !filters.status || m.status === filters.status;
                    const matchPeriod = isWithinPeriod(m.createdAt, listPeriod, selectedFilterDate);
                    return matchProject && matchSearch && matchUnit && matchStatus && matchPeriod;
                });
            }, [maintenances, filters, listPeriod, selectedFilterDate, activeProjectId]);

            // Handlers
            const handleRequestAccess = async (guestName) => {
                const docRef = await addDoc(collection(db, 'artifacts', appId, 'public', 'data', 'access_requests'), {
                    name: guestName, status: 'pending', createdAt: new Date().toISOString()
                });
                setAccessRequestId(docRef.id); setAccessRequestStatus('pending');
            };

            const handleSaveMaintenance = async (data) => {
                try {
                    const pid = activeProjectId !== 'all' ? activeProjectId : 'none';
                    const docData = { 
                        ...data, 
                        projectId: data.projectId || pid,
                        value: Number(data.value) || 0 
                    };

                    if (editingItem) {
                        const docRef = doc(db, 'artifacts', appId, 'public', 'data', 'maintenances', editingItem.id);
                        await updateDoc(docRef, { ...docData, updatedAt: new Date().toISOString() });
                        setEditingItem(null);
                    } else {
                        await addDoc(collection(db, 'artifacts', appId, 'public', 'data', 'maintenances'), { 
                            ...docData, 
                            createdAt: new Date().toISOString() 
                        });
                    }

                    const docSettings = doc(db, 'artifacts', appId, 'public', 'data', 'settings', 'global');
                    const updates = {};
                    
                    if (data.department && !settings.departments.includes(data.department)) {
                        updates.departments = arrayUnion(data.department);
                    }
                    if (data.supplier && !settings.suppliers.includes(data.supplier)) {
                        updates.suppliers = arrayUnion(data.supplier);
                    }

                    if (Object.keys(updates).length > 0) {
                        await updateDoc(docSettings, updates).catch(() => {
                            return setDoc(docSettings, {
                                appName: settings.appName,
                                primaryColor: settings.primaryColor,
                                units: settings.units,
                                ...updates
                            }, { merge: true });
                        });
                    }

                    setActiveTab('list');
                } catch (err) { 
                    console.error(err);
                    alert("Erro ao processar o registo. Por favor, tente novamente."); 
                }
            };

            const handleSaveProject = async (projName) => {
                if (!projName.trim()) return;
                try {
                    await addDoc(collection(db, 'artifacts', appId, 'public', 'data', 'projects'), { 
                        name: projName, 
                        createdAt: new Date().toISOString() 
                    });
                } catch (e) { alert("Erro ao criar projeto."); }
            };

            const handleDeleteAll = async () => {
                try {
                    const batch = writeBatch(db);
                    maintenances.forEach(m => {
                        const ref = doc(db, 'artifacts', appId, 'public', 'data', 'maintenances', m.id);
                        batch.delete(ref);
                    });
                    await batch.commit();
                    setShowClearAllModal(false);
                    alert("Limpeza concluída.");
                } catch (e) { 
                    setShowClearAllModal(false);
                    alert("Erro ao limpar registos."); 
                }
            };

            const handleSaveSettings = async (newSettings) => {
                const docRef = doc(db, 'artifacts', appId, 'public', 'data', 'settings', 'global');
                await setDoc(docRef, newSettings);
                alert("Configurações atualizadas!");
            };

            const handleApproveRequest = async (id) => await updateDoc(doc(db, 'artifacts', appId, 'public', 'data', 'access_requests', id), { status: 'approved' });
            const handleRejectRequest = async (id) => await updateDoc(doc(db, 'artifacts', appId, 'public', 'data', 'access_requests', id), { status: 'rejected' });

            const primaryColorStyle = { backgroundColor: settings.primaryColor };
            const projectsColor = "#f59e0b"; // Ambar

            // Componente de Filtro de Tempo Melhorado
            const TimeFilterButtons = ({ value, onChange, currentSelectedDate, onDateChange }) => {
                const years = Array.from({ length: 5 }, (_, i) => new Date().getFullYear() - i);
                
                return React.createElement('div', { className: "flex flex-col sm:flex-row items-end sm:items-center gap-2" },
                    React.createElement('div', { className: "flex bg-slate-200 p-1 rounded-xl" },
                        ['all', 'day', 'week', 'month', 'year'].map(p => {
                            const labels = { all: 'Todos', day: 'Hoje', week: '7 Dias', month: 'Mês', year: 'Ano' };
                            const isActive = value === p;
                            return React.createElement('button', {
                                key: p, onClick: () => onChange(p),
                                className: `px-3 py-1.5 text-xs font-bold rounded-lg transition-all ${isActive ? 'bg-white text-slate-900 shadow-sm' : 'text-slate-500 hover:text-slate-700'}`,
                            }, labels[p]);
                        })
                    ),
                    (value === 'month' || value === 'year') && React.createElement('div', { className: "flex gap-2 animate-in fade-in slide-in-from-right-2" },
                        value === 'month' && React.createElement('select', { 
                            className: "px-3 py-1.5 text-xs font-bold text-slate-700 bg-white border border-slate-200 rounded-xl outline-none shadow-sm cursor-pointer",
                            value: currentSelectedDate.getMonth(),
                            onChange: (e) => { 
                                const newDate = new Date(currentSelectedDate); 
                                newDate.setMonth(parseInt(e.target.value)); 
                                onDateChange(newDate); 
                            }
                        }, MONTHS.map((m, i) => React.createElement('option', { key: i, value: i }, m))),
                        React.createElement('select', { 
                            className: "px-3 py-1.5 text-xs font-bold text-slate-700 bg-white border border-slate-200 rounded-xl outline-none shadow-sm cursor-pointer",
                            value: currentSelectedDate.getFullYear(),
                            onChange: (e) => { 
                                const newDate = new Date(currentSelectedDate); 
                                newDate.setFullYear(parseInt(e.target.value)); 
                                onDateChange(newDate); 
                            }
                        }, years.map(y => React.createElement('option', { key: y, value: y }, y)))
                    )
                );
            };

            if (!isAuthenticated) return React.createElement(LoginScreen, { onLogin: (role) => { setIsAuthenticated(true); setCurrentUserRole(role); }, onRequestAccess: handleRequestAccess, accessStatus: accessRequestStatus });

            return React.createElement('div', { className: "min-h-screen bg-slate-50 flex flex-col md:flex-row text-slate-800 font-sans" },
                React.createElement(ConfirmationModal, { isOpen: !!deleteId, onClose: () => setDeleteId(null), onConfirm: async () => { await deleteDoc(doc(db, 'artifacts', appId, 'public', 'data', 'maintenances', deleteId)); setDeleteId(null); } }),
                
                showClearAllModal && React.createElement('div', { className: "fixed inset-0 z-[60] flex items-center justify-center p-4 bg-slate-900/80 backdrop-blur-sm" },
                    React.createElement('div', { className: "bg-white rounded-3xl p-8 max-w-sm w-full text-center shadow-2xl animate-in zoom-in-95 duration-200" },
                        React.createElement('div', { className: "w-16 h-16 bg-red-100 rounded-full flex items-center justify-center mx-auto mb-4" }, React.createElement(AlertTriangle, { className: "text-red-600", size: 32 })),
                        React.createElement('h3', { className: "text-xl font-bold mb-2" }, "Limpar Tudo?"),
                        React.createElement('p', { className: "text-slate-500 text-sm mb-6" }, "Deseja apagar todos os registos do sistema?"),
                        React.createElement('div', { className: "flex gap-3" }, 
                            React.createElement('button', { onClick: () => setShowClearAllModal(false), className: "flex-1 p-3 bg-slate-100 rounded-xl font-bold" }, "Não"), 
                            React.createElement('button', { onClick: handleDeleteAll, className: "flex-1 p-3 bg-red-600 text-white rounded-xl font-bold" }, "Sim, Limpar")
                        )
                    )
                ),

                React.createElement(UnitDetailsModal, { isOpen: !!viewingUnit, onClose: () => setViewingUnit(null), unitName: viewingUnit, data: maintenances.filter(m => isWithinPeriod(m.createdAt, dashboardPeriod, selectedFilterDate)), primaryColor: settings.primaryColor }),

                showRequestsModal && React.createElement('div', { className: "fixed inset-0 z-50 flex items-center justify-center p-4 bg-slate-900/60 backdrop-blur-sm" },
                    React.createElement('div', { className: "bg-white rounded-2xl max-w-md w-full p-6 shadow-2xl" },
                        React.createElement('div', { className: "flex justify-between items-center mb-6" }, React.createElement('h3', { className: "font-bold text-lg" }, "Solicitações de Acesso"), React.createElement('button', { onClick: () => setShowRequestsModal(false) }, React.createElement(X))),
                        pendingRequests.length === 0 ? React.createElement('p', { className: "text-slate-500 text-center py-4" }, "Nenhuma solicitação pendente.") :
                        React.createElement('div', { className: "space-y-3" }, pendingRequests.map(req => React.createElement('div', { key: req.id, className: "flex items-center justify-between bg-slate-50 p-3 rounded-xl" },
                            React.createElement('div', null, React.createElement('p', { className: "font-bold text-slate-800" }, req.name), React.createElement('p', { className: "text-xs text-slate-400" }, formatDate(req.createdAt))),
                            React.createElement('div', { className: "flex gap-2" },
                                React.createElement('button', { onClick: () => handleRejectRequest(req.id), className: "p-2 bg-red-100 text-red-600 rounded-lg" }, React.createElement(X, { size: 16 })),
                                React.createElement('button', { onClick: () => handleApproveRequest(req.id), className: "p-2 bg-green-100 text-green-600 rounded-lg" }, React.createElement(Check, { size: 16 }))
                            )
                        )))
                    )
                ),

                React.createElement('nav', { className: "w-full md:w-64 bg-slate-900 text-white p-6 space-y-4 shadow-xl z-10 flex flex-col" },
                    React.createElement('div', { className: "flex items-center justify-between mb-8" },
                        React.createElement('div', { className: "flex items-center space-x-3" }, React.createElement('div', { style: primaryColorStyle, className: "p-2 rounded-lg" }, React.createElement(LayoutDashboard, { size: 20 })), React.createElement('span', { className: "font-bold text-lg leading-tight" }, settings.appName)),
                        currentUserRole === 'owner' && React.createElement('div', { className: "relative cursor-pointer", onClick: () => setShowRequestsModal(true) }, React.createElement(Bell, { size: 20, className: "text-slate-400 hover:text-white" }), pendingRequests.length > 0 && React.createElement('div', { className: "absolute -top-1 -right-1 w-3 h-3 bg-red-500 rounded-full pulse-ring" }))
                    ),
                    
                    React.createElement('div', { className: "space-y-2 flex-1" },
                        React.createElement('div', { className: "space-y-1" },
                            React.createElement('button', { 
                                onClick: () => { setActiveTab('projects'); setEditingItem(null); },
                                className: `w-full flex items-center p-3 rounded-xl transition-all ${activeTab === 'projects' ? 'shadow-lg text-white font-bold' : 'hover:bg-slate-800 text-slate-400'}`,
                                style: activeTab === 'projects' ? { backgroundColor: projectsColor } : {}
                            }, React.createElement(FolderKanban, { className: "mr-3", size: 18 }), "Projetos"),
                            
                            activeProjectId !== 'all' && React.createElement('div', { className: "px-3 py-2 mx-2 mt-1 bg-amber-900/20 rounded-lg border-l-4 border-amber-500 animate-in slide-in-from-top-1" },
                                React.createElement('p', { className: "text-[9px] uppercase font-black text-amber-500 tracking-wider" }, "Contexto Ativo:"),
                                React.createElement('div', { className: "flex items-center justify-between mt-0.5" },
                                    React.createElement('span', { className: "text-xs font-bold text-white truncate max-w-[130px]" }, projects.find(p => p.id === activeProjectId)?.name),
                                    React.createElement('button', { onClick: (e) => { e.stopPropagation(); setActiveProjectId('all'); }, className: "text-amber-500/50 hover:text-white ml-1" }, React.createElement(X, { size: 12 }))
                                )
                            )
                        ),

                        React.createElement('button', { 
                            onClick: () => { setActiveTab('dashboard'); setEditingItem(null); },
                            className: `w-full flex items-center p-3 rounded-xl transition-all ${activeTab === 'dashboard' ? 'shadow-lg text-white font-bold' : 'hover:bg-slate-800 text-slate-400'}`,
                            style: activeTab === 'dashboard' ? primaryColorStyle : {}
                        }, React.createElement(TrendingUp, { className: "mr-3", size: 18 }), "Painel"),

                        React.createElement('button', { 
                            onClick: () => { setActiveTab('form'); setEditingItem(null); },
                            className: `w-full flex items-center p-3 rounded-xl transition-all ${activeTab === 'form' ? 'shadow-lg text-white font-bold' : 'hover:bg-slate-800 text-slate-400'}`,
                            style: activeTab === 'form' ? primaryColorStyle : {}
                        }, React.createElement(PlusCircle, { className: "mr-3", size: 18 }), "Novo Registro"),

                        React.createElement('button', { 
                            onClick: () => { setActiveTab('list'); setEditingItem(null); },
                            className: `w-full flex items-center p-3 rounded-xl transition-all ${activeTab === 'list' ? 'shadow-lg text-white font-bold' : 'hover:bg-slate-800 text-slate-400'}`,
                            style: activeTab === 'list' ? primaryColorStyle : {}
                        }, React.createElement(List, { className: "mr-3", size: 18 }), "Listagem"),

                        React.createElement('button', { 
                            onClick: () => { setActiveTab('admin'); setEditingItem(null); },
                            className: `w-full flex items-center p-3 rounded-xl transition-all ${activeTab === 'admin' ? 'shadow-lg text-white font-bold' : 'hover:bg-slate-800 text-slate-400'}`,
                            style: activeTab === 'admin' ? primaryColorStyle : {}
                        }, React.createElement(Settings, { className: "mr-3", size: 18 }), "Administrativo")
                    ),

                    React.createElement('div', { className: "mt-auto pt-6 border-t border-slate-800 text-slate-500 text-xs font-bold" }, React.createElement(User, { size: 14, className: "mr-2 inline" }), currentUserRole === 'owner' ? 'Jordan (Dono)' : 'Visitante')
                ),

                React.createElement('main', { className: "flex-1 p-6 md:p-10 overflow-y-auto" },
                    loading ? React.createElement('div', { className: "flex flex-col items-center justify-center h-full" }, React.createElement('div', { className: "animate-spin rounded-full h-10 w-10 border-b-2", style: { borderColor: settings.primaryColor } }), "A carregar...") :
                    React.createElement('div', { className: "max-w-6xl mx-auto" },
                        
                        activeTab === 'dashboard' && React.createElement('div', { className: "space-y-8 animate-in fade-in" },
                            React.createElement('div', { className: "flex flex-col md:flex-row justify-between items-start md:items-center gap-4" },
                                React.createElement('div', null,
                                    React.createElement('h2', { className: "text-2xl font-bold text-slate-900" }, activeProjectId === 'all' ? "Painel Geral" : `Painel: ${projects.find(p => p.id === activeProjectId)?.name}`),
                                    activeProjectId !== 'all' && React.createElement('p', { className: "text-sm text-slate-500" }, "Visualizando dados específicos deste projeto")
                                ),
                                React.createElement(TimeFilterButtons, { 
                                    value: dashboardPeriod, 
                                    onChange: setDashboardPeriod, 
                                    currentSelectedDate: selectedFilterDate, 
                                    onDateChange: setSelectedFilterDate 
                                })
                            ),

                            React.createElement('div', { className: "grid grid-cols-1 md:grid-cols-3 gap-6" },
                                React.createElement('div', { className: "bg-white p-6 rounded-3xl border shadow-sm border-l-4 border-slate-900" }, React.createElement('p', { className: "text-slate-400 text-xs font-bold uppercase" }, "Valor Total"), React.createElement('p', { className: "text-3xl font-black mt-2 text-slate-800" }, `R$ ${stats.totalValue.toLocaleString('pt-BR', { minimumFractionDigits: 2 })}`)),
                                React.createElement('div', { className: "bg-white p-6 rounded-3xl border shadow-sm border-l-4 border-green-500" }, React.createElement('p', { className: "text-green-600/70 text-xs font-bold uppercase" }, "Valor Aprovado"), React.createElement('p', { className: "text-3xl font-black mt-2 text-green-600" }, `R$ ${stats.valueExecutado.toLocaleString('pt-BR', { minimumFractionDigits: 2 })}`)),
                                React.createElement('div', { className: "bg-white p-6 rounded-3xl border shadow-sm border-l-4 border-blue-500" }, React.createElement('p', { className: "text-blue-600/70 text-xs font-bold uppercase" }, "Valor Pendente"), React.createElement('p', { className: "text-3xl font-black mt-2 text-blue-600" }, `R$ ${stats.valuePendente.toLocaleString('pt-BR', { minimumFractionDigits: 2 })}`))
                            ),

                            React.createElement('div', { className: "grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4" },
                                React.createElement('div', { className: "bg-white p-5 rounded-2xl border flex items-center justify-between" }, React.createElement('div', null, React.createElement('p', { className: "text-slate-400 text-xs font-bold uppercase" }, "Pedidos"), React.createElement('p', { className: "text-2xl font-black text-slate-800" }, stats.count)), React.createElement(List, { size: 24, className: "text-slate-300" })),
                                React.createElement('div', { className: "bg-white p-5 rounded-2xl border flex items-center justify-between" }, React.createElement('div', null, React.createElement('p', { className: "text-green-600/70 text-xs font-bold uppercase" }, "Executados"), React.createElement('p', { className: "text-2xl font-black text-green-600" }, stats.countExecutado)), React.createElement(CheckSquare, { size: 24, className: "text-green-200" })),
                                React.createElement('div', { className: "bg-white p-5 rounded-2xl border flex items-center justify-between" }, React.createElement('div', null, React.createElement('p', { className: "text-blue-600/70 text-xs font-bold uppercase" }, "Aguardando"), React.createElement('p', { className: "text-2xl font-black text-blue-600" }, stats.countPendente)), React.createElement(Hourglass, { size: 24, className: "text-blue-200" })),
                                React.createElement('div', { className: "bg-white p-5 rounded-2xl border flex items-center justify-between" }, React.createElement('div', null, React.createElement('p', { className: "text-red-600/70 text-xs font-bold uppercase" }, "Indeferidos"), React.createElement('p', { className: "text-2xl font-black text-red-600" }, stats.countIndeferido)), React.createElement(XSquare, { size: 24, className: "text-red-200" }))
                            ),

                            React.createElement('div', { className: "bg-white p-8 rounded-3xl border shadow-sm flex flex-col md:flex-row items-center gap-6" },
                                React.createElement('div', { className: "flex-1" }, React.createElement('h3', { className: "font-bold text-lg flex items-center gap-2" }, React.createElement(FileSpreadsheet, { className: "text-green-600" }), "Exportar Relatório"), React.createElement('p', { className: "text-slate-400 text-sm" }, "Gere um arquivo CSV organizado com os dados filtrados.")),
                                React.createElement('div', { className: "flex flex-col sm:flex-row gap-3 items-center" },
                                    React.createElement(TimeFilterButtons, { 
                                        value: exportPeriod, 
                                        onChange: setExportPeriod, 
                                        currentSelectedDate: exportDate, 
                                        onDateChange: setExportDate 
                                    }),
                                    React.createElement('button', { onClick: () => {
                                        const data = maintenances.filter(m => isWithinPeriod(m.createdAt, exportPeriod, exportDate));
                                        if(data.length > 0) exportToCSV(data, "Relatorio_ChairControl");
                                        else alert("Sem dados para exportar.");
                                    }, className: "bg-slate-900 text-white px-6 py-3 rounded-xl font-bold flex items-center gap-2" }, React.createElement(Download, { size: 18 }), "Exportar")
                                )
                            ),

                            React.createElement('div', { className: "grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6" },
                                stats.unitStats.map(unit => React.createElement('div', { key: unit.name, className: "bg-white p-6 rounded-2xl border hover:shadow-md transition-all group" },
                                    React.createElement('div', { className: "flex justify-between items-center mb-4" }, React.createElement(Building2, { className: "text-slate-300" }), React.createElement('span', { className: "bg-slate-100 text-slate-500 px-2 py-1 rounded-lg text-xs font-bold" }, `${unit.count} Pedidos`)),
                                    React.createElement('h4', { className: "font-bold text-lg truncate" }, unit.name),
                                    React.createElement('p', { className: "text-slate-400 text-sm font-medium mb-6" }, `Total: R$ ${unit.totalValue.toLocaleString('pt-BR', { minimumFractionDigits: 2 })}`),
                                    React.createElement('button', { onClick: () => setViewingUnit(unit.name), className: "w-full py-3 bg-slate-50 text-slate-600 rounded-xl font-bold hover:bg-slate-900 hover:text-white flex items-center justify-center gap-2" }, React.createElement(Eye, { size: 16 }), "Ver Detalhes")
                                ))
                            )
                        ),

                        activeTab === 'projects' && React.createElement(ProjectsView, { 
                            projects: projects, 
                            onSelect: (id) => { setActiveProjectId(id); setActiveTab('dashboard'); },
                            onCreate: handleSaveProject,
                            onDelete: async (id) => await deleteDoc(doc(db, 'artifacts', appId, 'public', 'data', 'projects', id)),
                            primaryColor: projectsColor
                        }),

                        activeTab === 'form' && React.createElement(MaintenanceForm, { 
                            onSubmit: handleSaveMaintenance, 
                            initialData: editingItem, 
                            onCancel: () => setActiveTab('list'), 
                            units: settings.units, 
                            existingDepartments: settings.departments, 
                            existingSuppliers: settings.suppliers, 
                            primaryColor: settings.primaryColor 
                        }),

                        activeTab === 'list' && React.createElement('div', { className: "space-y-6 animate-in fade-in" },
                            React.createElement('div', { className: "flex flex-col gap-4" },
                                React.createElement('div', { className: "flex justify-between items-center" },
                                    React.createElement('h2', { className: "text-xl font-bold text-slate-900" }, "Listagem de Pedidos"),
                                    React.createElement('div', { className: "flex gap-2" },
                                        React.createElement('button', { onClick: () => setShowClearAllModal(true), className: "px-4 py-2 bg-red-100 text-red-600 rounded-xl text-xs font-bold hover:bg-red-200 flex items-center gap-2" }, React.createElement(RefreshCw, { size: 14 }), "Limpar Tudo"),
                                        React.createElement(TimeFilterButtons, { 
                                            value: listPeriod, 
                                            onChange: setListPeriod, 
                                            currentSelectedDate: selectedFilterDate, 
                                            onDateChange: setSelectedFilterDate 
                                        })
                                    )
                                ),
                                React.createElement('div', { className: "flex flex-col md:flex-row gap-4" },
                                    React.createElement('div', { className: "relative flex-1" }, React.createElement(Search, { className: "absolute left-3 top-1/2 -translate-y-1/2 text-slate-400", size: 18 }), React.createElement('input', { placeholder: "Procurar...", className: "w-full pl-10 pr-4 py-3 border rounded-xl outline-none focus:ring-2", style: { '--tw-ring-color': settings.primaryColor }, onChange: e => setFilters({ ...filters, search: e.target.value }) })),
                                    React.createElement('select', { className: "p-3 border rounded-xl bg-white min-w-[150px]", value: filters.unit, onChange: e => setFilters({ ...filters, unit: e.target.value }) }, React.createElement('option', { value: "" }, "Unidades"), settings.units.map(u => React.createElement('option', { key: u, value: u }, u))),
                                    React.createElement('select', { className: "p-3 border rounded-xl bg-white min-w-[150px]", value: filters.status, onChange: e => setFilters({ ...filters, status: e.target.value }) }, 
                                        React.createElement('option', { value: "" }, "Status"), 
                                        STATUS_OPTIONS.map(s => React.createElement('option', { key: s.value, value: s.value }, s.label))
                                    )
                                )
                            ),
                            React.createElement('div', { className: "bg-white rounded-3xl border shadow-sm overflow-hidden" },
                                React.createElement('div', { className: "overflow-x-auto" },
                                    React.createElement('table', { className: "w-full text-left" },
                                        React.createElement('thead', { className: "bg-slate-50 border-b" }, React.createElement('tr', null, React.createElement('th', { className: "p-5 text-xs font-bold uppercase text-slate-500" }, "Data"), React.createElement('th', { className: "p-5 text-xs font-bold uppercase text-slate-500" }, "Unidade"), React.createElement('th', { className: "p-5 text-xs font-bold uppercase text-slate-500" }, "Valor"), React.createElement('th', { className: "p-5 text-xs font-bold uppercase text-slate-500" }, "Status"), React.createElement('th', { className: "p-5 text-xs font-bold uppercase text-slate-500 text-center" }, "Ações"))),
                                        React.createElement('tbody', { className: "divide-y" }, filteredListData.map(item => React.createElement('tr', { key: item.id, className: "hover:bg-slate-50" },
                                            React.createElement('td', { className: "p-5 text-sm font-medium" }, formatDate(item.createdAt).split(' ')[0]),
                                            React.createElement('td', { className: "p-5" }, React.createElement('p', { className: "font-bold text-slate-900" }, item.unit), React.createElement('p', { className: "text-xs text-slate-500" }, item.department)),
                                            React.createElement('td', { className: "p-5 font-bold" }, `R$ ${Number(item.value).toLocaleString('pt-BR', { minimumFractionDigits: 2 })}`),
                                            React.createElement('td', { className: "p-5" }, React.createElement('span', { className: `px-3 py-1 rounded-full text-[10px] font-black uppercase border ${STATUS_OPTIONS.find(s => s.value === item.status)?.color}` }, item.status)),
                                            React.createElement('td', { className: "p-5 flex justify-center gap-2" }, 
                                                React.createElement('button', { onClick: () => { setEditingItem(item); setActiveTab('form'); }, className: "p-2 text-slate-400 hover:text-blue-600" }, React.createElement(Edit2, { size: 16 })), 
                                                React.createElement('button', { onClick: () => setDeleteId(item.id), className: "p-2 text-slate-400 hover:text-red-600" }, React.createElement(Trash2, { size: 16 }))
                                            )
                                        )))
                                    )
                                ),
                                filteredListData.length === 0 && React.createElement('div', { className: "p-20 text-center text-slate-400" }, "Nenhum registo encontrado.")
                            )
                        ),

                        activeTab === 'admin' && React.createElement(AdminPanel, { currentSettings: settings, onSave: handleSaveSettings })
                    )
                )
            );
        }

        // --- ABA DE PROJETOS ---
        function ProjectsView({ projects, onSelect, onCreate, onDelete, primaryColor }) {
            const [newProjName, setNewProjName] = useState('');
            const [showCreate, setShowCreate] = useState(false);

            return React.createElement('div', { className: "space-y-8 animate-in fade-in" },
                React.createElement('div', { className: "flex justify-between items-center" },
                    React.createElement('div', null,
                        React.createElement('h2', { className: "text-2xl font-bold text-slate-900" }, "Gestão de Projetos"),
                        React.createElement('p', { className: "text-slate-500 text-sm" }, "Selecione um projeto para visualizar os seus dados específicos.")
                    ),
                    React.createElement('button', { 
                        onClick: () => setShowCreate(!showCreate),
                        className: "bg-slate-900 text-white px-5 py-2.5 rounded-xl font-bold text-sm flex items-center gap-2"
                    }, React.createElement(PlusCircle, { size: 18 }), "Criar Projeto")
                ),

                showCreate && React.createElement('form', { 
                    onSubmit: (e) => { e.preventDefault(); onCreate(newProjName); setNewProjName(''); setShowCreate(false); },
                    className: "bg-white p-6 rounded-3xl border shadow-sm flex gap-3 animate-in slide-in-from-top-4"
                },
                    React.createElement('input', { 
                        className: "flex-1 p-4 border rounded-2xl outline-none focus:ring-2", 
                        style: { '--tw-ring-color': primaryColor },
                        value: newProjName, 
                        onChange: e => setNewProjName(e.target.value), 
                        placeholder: "Nome do projeto..." 
                    }),
                    React.createElement('button', { type: "submit", className: "px-8 bg-slate-900 text-white font-bold rounded-2xl" }, "Adicionar")
                ),

                React.createElement('div', { className: "grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6" },
                    React.createElement('button', { 
                        onClick: () => onSelect('all'),
                        className: "bg-white p-8 rounded-3xl border border-dashed border-slate-300 hover:border-slate-900 transition-all text-left flex flex-col justify-between group"
                    },
                        React.createElement(Briefcase, { className: "text-slate-300 group-hover:text-slate-900 transition-colors mb-4", size: 32 }),
                        React.createElement('div', null,
                            React.createElement('h3', { className: "font-bold text-xl" }, "Visão Geral"),
                            React.createElement('p', { className: "text-slate-400 text-sm" }, "Ver todas as manutenções sem filtros de projeto.")
                        )
                    ),
                    projects.map(proj => React.createElement('div', { key: proj.id, className: "bg-white p-8 rounded-3xl border hover:shadow-xl transition-all flex flex-col justify-between group relative" },
                        React.createElement('button', { 
                            onClick: (e) => { e.stopPropagation(); onDelete(proj.id); },
                            className: "absolute top-4 right-4 p-2 text-slate-200 hover:text-red-600 transition-colors"
                        }, React.createElement(Trash2, { size: 16 })),
                        React.createElement(FolderKanban, { className: "text-slate-900 mb-4", size: 32 }),
                        React.createElement('div', null,
                            React.createElement('h3', { className: "font-bold text-xl" }, proj.name),
                            React.createElement('button', { 
                                onClick: () => onSelect(proj.id),
                                className: "mt-4 flex items-center gap-2 text-sm font-black uppercase tracking-wider group-hover:translate-x-1 transition-transform",
                                style: { color: primaryColor }
                            }, "Aceder Projeto", React.createElement(ChevronRight, { size: 14 }))
                        )
                    ))
                )
            );
        }

        // --- FORMULÁRIO ---
        function MaintenanceForm({ onSubmit, initialData, onCancel, units, existingDepartments, existingSuppliers, primaryColor }) {
            const initialFormState = { unit: '', department: '', supplier: '', orderNumber: '', value: '', status: 'Aguardando Aprovação' };
            const [formData, setFormData] = useState(initialFormState);
            const [showConfirmClear, setShowConfirmClear] = useState(false);
            
            useEffect(() => { if (initialData) setFormData(initialData); }, [initialData]);
            
            const handleClearForm = () => {
                setFormData(initialFormState);
                setShowConfirmClear(false);
            };

            const primaryColorStyle = { backgroundColor: primaryColor };

            return React.createElement('div', { className: "max-w-2xl mx-auto bg-white p-10 rounded-3xl border shadow-2xl relative" },
                showConfirmClear && React.createElement('div', { className: "absolute inset-0 z-20 bg-white/95 rounded-3xl flex items-center justify-center p-8 text-center" },
                    React.createElement('div', { className: "space-y-4" },
                        React.createElement('div', { className: "w-12 h-12 bg-amber-100 text-amber-600 rounded-full flex items-center justify-center mx-auto" }, React.createElement(RefreshCw, { size: 24 })),
                        React.createElement('h3', { className: "font-bold text-lg" }, "Limpar campos?"),
                        React.createElement('div', { className: "flex gap-2" },
                            React.createElement('button', { onClick: () => setShowConfirmClear(false), className: "flex-1 px-4 py-2 bg-slate-100 rounded-xl font-bold" }, "Não"),
                            React.createElement('button', { onClick: handleClearForm, className: "flex-1 px-4 py-2 bg-amber-600 text-white rounded-xl font-bold" }, "Sim")
                        )
                    )
                ),
                React.createElement('div', { className: "flex justify-between mb-8" }, React.createElement('h2', { className: "text-2xl font-black text-slate-900" }, initialData ? 'Editar Registo' : 'Novo Registo'), React.createElement('button', { onClick: onCancel, className: "text-slate-400 hover:bg-slate-100 p-2 rounded-full" }, React.createElement(X))),
                React.createElement('form', { 
                    onSubmit: (e) => { 
                        e.preventDefault(); 
                        if(!formData.unit) return alert("Por favor, selecione uma unidade.");
                        onSubmit(formData); 
                    }, 
                    className: "space-y-6" 
                },
                    React.createElement('div', { className: "space-y-2" }, React.createElement('label', { className: "text-sm font-bold" }, "Unidade"), React.createElement('select', { required: true, className: "w-full p-4 border rounded-2xl bg-slate-50 focus:ring-2", style: { '--tw-ring-color': primaryColor }, value: formData.unit, onChange: e => setFormData({ ...formData, unit: e.target.value }) }, React.createElement('option', { value: "" }, "Selecionar..."), units.map(u => React.createElement('option', { key: u, value: u }, u)))),
                    React.createElement('div', { className: "space-y-2" }, React.createElement('label', { className: "text-sm font-bold" }, "Departamento"), React.createElement('input', { list: "dept-list", className: "w-full p-4 border rounded-2xl bg-slate-50", value: formData.department, onChange: e => setFormData({ ...formData, department: e.target.value }) }), React.createElement('datalist', { id: "dept-list" }, existingDepartments.map(d => React.createElement('option', { key: d, value: d })))),
                    React.createElement('div', { className: "space-y-2" }, React.createElement('label', { className: "text-sm font-bold" }, "Fornecedor"), React.createElement('input', { list: "supp-list", className: "w-full p-4 border rounded-2xl bg-slate-50", value: formData.supplier, onChange: e => setFormData({ ...formData, supplier: e.target.value }) }), React.createElement('datalist', { id: "supp-list" }, existingSuppliers.map(s => React.createElement('option', { key: s, value: s })))),
                    React.createElement('div', { className: "grid grid-cols-2 gap-6" },
                        React.createElement('div', { className: "space-y-2" }, React.createElement('label', { className: "text-sm font-bold" }, "Nº Pedido (6 dígitos)"), React.createElement('input', { required: true, maxLength: 6, className: "w-full p-4 border rounded-2xl font-mono", value: formData.orderNumber, onChange: e => setFormData({ ...formData, orderNumber: e.target.value.replace(/\D/g, '') }) })),
                        React.createElement('div', { className: "space-y-2" }, React.createElement('label', { className: "text-sm font-bold" }, "Valor (R$)"), React.createElement('input', { required: true, type: "number", step: "0.01", className: "w-full p-4 border rounded-2xl", value: formData.value, onChange: e => setFormData({ ...formData, value: e.target.value }) }))
                    ),
                    
                    React.createElement('div', { className: "space-y-3" }, 
                        React.createElement('label', { className: "text-sm font-bold" }, "Status"), 
                        React.createElement('div', { className: "flex flex-wrap gap-2" }, STATUS_OPTIONS.map(s => React.createElement('button', { key: s.value, type: "button", onClick: () => setFormData({ ...formData, status: s.value }), className: `flex-1 py-3 rounded-xl border text-[10px] font-black uppercase transition-all ${formData.status === s.value ? s.color + ' ring-4 ring-offset-2 ring-slate-200 border-blue-500' : 'bg-white text-slate-400 border-slate-100 hover:border-slate-300'}` }, s.label)))
                    ),

                    React.createElement('div', { className: "flex flex-col sm:flex-row gap-4 pt-6 border-t mt-6" },
                        React.createElement('button', { type: "submit", className: "flex-1 text-white py-4 rounded-2xl font-bold shadow-lg transition-transform active:scale-95", style: primaryColorStyle }, "Novo Registro"),
                        !initialData && React.createElement('button', { type: "button", onClick: () => setShowConfirmClear(true), className: "px-6 py-4 bg-slate-100 text-slate-500 rounded-2xl font-bold flex items-center justify-center gap-2 hover:bg-slate-200" }, React.createElement(Eraser, { size: 18 }), "Limpar")
                    )
                )
            );
        }

        // --- DETALHAMENTO DE UNIDADES ---
        function UnitDetailsModal({ isOpen, onClose, unitName, data, primaryColor }) {
            const [statusActiveIndex, setStatusActiveIndex] = useState(-1);
            const unitItems = useMemo(() => data.filter(i => i.unit === unitName), [data, unitName]);
            
            const stats = useMemo(() => {
                const total = unitItems.length;
                const totalValue = unitItems.reduce((acc, curr) => acc + Number(curr.value || 0), 0);
                
                const counts = { 'Executado': 0, 'Aguardando Aprovação': 0, 'Indeferido': 0 };
                unitItems.forEach(item => { if (counts[item.status] !== undefined) counts[item.status]++; });
                
                const deptCounts = {};
                unitItems.forEach(item => { const d = item.department || 'Geral'; deptCounts[d] = (deptCounts[d] || 0) + 1; });
                const deptChartData = Object.entries(deptCounts).map(([name, value]) => ({ name, value })).sort((a, b) => b.value - a.value); 
                const statusChartData = Object.entries(counts).map(([name, value]) => ({ name, value })).filter(i => i.value > 0);
                
                return { total, totalValue, counts, deptChartData, statusChartData };
            }, [unitItems]);

            if (!isOpen) return null;

            return React.createElement('div', { className: "fixed inset-0 z-50 flex items-center justify-center p-4 bg-slate-900/60 backdrop-blur-md" },
                React.createElement('div', { className: "bg-white rounded-3xl shadow-2xl max-w-5xl w-full h-[90vh] overflow-hidden flex flex-col" },
                    React.createElement('div', { className: "p-6 border-b flex justify-between items-center bg-white" },
                        React.createElement('div', null, React.createElement('p', { className: "text-slate-400 text-xs font-bold uppercase" }, "Detalhamento"), React.createElement('h2', { className: "text-2xl font-black" }, unitName)),
                        React.createElement('button', { onClick: onClose, className: "bg-slate-100 p-2 rounded-full" }, React.createElement(X))
                    ),
                    React.createElement('div', { className: "p-8 space-y-8 overflow-y-auto flex-1 custom-scrollbar" },
                        React.createElement('div', { className: "grid grid-cols-2 md:grid-cols-4 gap-4" },
                            React.createElement('div', { className: "bg-slate-50 p-4 rounded-xl border text-center" }, React.createElement('p', { className: "text-slate-400 text-[10px] font-bold uppercase" }, "Pedidos"), React.createElement('p', { className: "text-2xl font-black" }, stats.total)),
                            React.createElement('div', { className: "bg-green-50 p-4 rounded-xl border-green-100 border text-center" }, React.createElement('p', { className: "text-green-600/70 text-[10px] font-bold uppercase" }, "Executados"), React.createElement('p', { className: "text-2xl font-black text-green-600" }, stats.counts['Executado'])),
                            React.createElement('div', { className: "bg-blue-50 p-4 rounded-xl border-blue-100 border text-center" }, React.createElement('p', { className: "text-blue-600/70 text-[10px] font-bold uppercase" }, "Pendentes"), React.createElement('p', { className: "text-2xl font-black text-blue-600" }, stats.counts['Aguardando Aprovação'])),
                            React.createElement('div', { className: "bg-red-50 p-4 rounded-xl border-red-100 border text-center" }, React.createElement('p', { className: "text-red-600/70 text-[10px] font-bold uppercase" }, "Indeferidos"), React.createElement('p', { className: "text-2xl font-black text-red-600" }, stats.counts['Indeferido']))
                        ),
                        React.createElement('div', { className: "bg-slate-900 p-6 rounded-2xl text-white" }, 
                            React.createElement('p', { className: "text-slate-400 text-xs font-bold uppercase" }, "Investimento Total na Unidade"), 
                            React.createElement('p', { className: "text-3xl font-black mt-2" }, `R$ ${stats.totalValue.toLocaleString('pt-BR', { minimumFractionDigits: 2 })}`)
                        ),
                        React.createElement('div', { className: "grid grid-cols-1 md:grid-cols-2 gap-8" },
                            React.createElement('div', { className: "bg-white p-6 rounded-2xl border" },
                                React.createElement('h4', { className: "text-sm font-bold mb-6 flex items-center" }, React.createElement(BarChartIcon, { size: 16, className: "mr-2 text-slate-400" }), "Pedidos por Departamento"),
                                React.createElement('div', { className: "h-64" }, React.createElement(ResponsiveContainer, {}, React.createElement(PieChart, {}, React.createElement(Pie, { data: stats.deptChartData, dataKey: "value", innerRadius: 0, outerRadius: 80 }, stats.deptChartData.map((_, i) => React.createElement(Cell, { key: i, fill: DEPT_COLORS[i % DEPT_COLORS.length] }))), React.createElement(Tooltip), React.createElement(Legend)))),
                                React.createElement('div', { className: "mt-4 space-y-2 max-h-32 overflow-y-auto custom-scrollbar" }, stats.deptChartData.map((dept, idx) => React.createElement('div', { key: idx, className: "flex justify-between text-xs font-medium border-b py-1" }, React.createElement('span', null, dept.name), React.createElement('span', null, dept.value))))
                            ),
                            React.createElement('div', { className: "bg-white p-6 rounded-2xl border flex flex-col items-center text-center" },
                                React.createElement('h4', { className: "text-sm font-bold mb-6" }, "Distribuição por Status"),
                                React.createElement('div', { className: "h-64 w-full" }, React.createElement(ResponsiveContainer, {}, React.createElement(PieChart, {}, React.createElement(Pie, { data: stats.statusChartData, dataKey: "value", innerRadius: 60, outerRadius: 80, paddingAngle: 5, onMouseEnter: (_, i) => setStatusActiveIndex(i), onMouseLeave: () => setStatusActiveIndex(-1) }, stats.statusChartData.map((e, i) => React.createElement(Cell, { key: i, fill: STATUS_OPTIONS.find(s => s.label === e.name)?.hex }))), React.createElement(Tooltip))))
                            )
                        )
                    ),
                    React.createElement('div', { className: "p-6 border-t bg-slate-50" }, React.createElement('button', { onClick: onClose, className: "w-full py-4 bg-white border rounded-xl font-bold hover:bg-slate-100 transition-colors" }, "Fechar Detalhes"))
                )
            );
        }

        // --- ADMINISTRATIVO ---
        function AdminPanel({ currentSettings, onSave }) {
            const [localSettings, setLocalSettings] = useState(currentSettings);
            useEffect(() => { setLocalSettings(currentSettings) }, [currentSettings]);
            
            const handleTextareaChange = (key, text) => setLocalSettings({ ...localSettings, [key]: text.split('\n').filter(l => l.trim()) });

            return React.createElement('div', { className: "max-w-3xl mx-auto space-y-8 animate-in slide-in-from-bottom-4" },
                React.createElement('h2', { className: "text-2xl font-black" }, "Configurações"),
                React.createElement('form', { 
                    onSubmit: (e) => { e.preventDefault(); onSave(localSettings); },
                    className: "bg-white p-8 rounded-3xl border shadow-sm space-y-6"
                },
                    React.createElement('div', { className: "space-y-2" }, React.createElement('label', { className: "text-sm font-bold" }, "Nome do App"), React.createElement('input', { className: "w-full p-4 border rounded-2xl bg-slate-50", value: localSettings.appName, onChange: e => setLocalSettings({ ...localSettings, appName: e.target.value }) })),
                    React.createElement('div', { className: "grid grid-cols-1 md:grid-cols-3 gap-6" },
                        React.createElement('div', { className: "space-y-2" }, React.createElement('label', { className: "text-sm font-bold" }, "Unidades"), React.createElement('textarea', { rows: 8, className: "w-full p-4 border rounded-2xl bg-slate-50 font-mono text-xs", value: localSettings.units.join('\n'), onChange: e => handleTextareaChange('units', e.target.value) })),
                        React.createElement('div', { className: "space-y-2" }, React.createElement('label', { className: "text-sm font-bold" }, "Departamentos"), React.createElement('textarea', { rows: 8, className: "w-full p-4 border rounded-2xl bg-slate-50 font-mono text-xs", value: (localSettings.departments || []).join('\n'), onChange: e => handleTextareaChange('departments', e.target.value) })),
                        React.createElement('div', { className: "space-y-2" }, React.createElement('label', { className: "text-sm font-bold" }, "Fornecedores"), React.createElement('textarea', { rows: 8, className: "w-full p-4 border rounded-2xl bg-slate-50 font-mono text-xs", value: (localSettings.suppliers || []).join('\n'), onChange: e => handleTextareaChange('suppliers', e.target.value) }))
                    ),
                    React.createElement('button', { type: "submit", className: "w-full bg-slate-900 text-white py-4 rounded-2xl font-bold flex items-center justify-center gap-2 transition-transform active:scale-95" }, React.createElement(Save, { size: 20 }), "Salvar Alterações")
                )
            );
        }

        function ConfirmationModal({ isOpen, onClose, onConfirm }) {
            if (!isOpen) return null;
            return React.createElement('div', { className: "fixed inset-0 z-50 flex items-center justify-center p-4 bg-slate-900/60 backdrop-blur-sm" },
                React.createElement('div', { className: "bg-white rounded-3xl p-6 max-w-sm w-full text-center shadow-2xl" },
                    React.createElement(AlertTriangle, { className: "text-red-600 mx-auto mb-4", size: 48 }),
                    React.createElement('h3', { className: "text-xl font-bold mb-2" }, "Excluir Registro?"),
                    React.createElement('div', { className: "flex gap-3 mt-4" }, React.createElement('button', { onClick: onClose, className: "flex-1 p-3 bg-slate-100 rounded-xl font-bold" }, "Cancelar"), React.createElement('button', { onClick: onConfirm, className: "flex-1 p-3 bg-red-600 text-white rounded-xl font-bold" }, "Excluir"))
                )
            );
        }

        const root = createRoot(document.getElementById('root'));
        root.render(React.createElement(App));
    </script>
</body>
</html>
